<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Casa de Rosa | Carrer de Font i Quer, 15, 07800 Eivissa | Ibiza, Illes Balears</title>
  <meta name="description" content="Casa de Rosa — Healthy Breakfast &amp; Lunch | Specialty Coffee | Vinyls — Carrer de Font i Quer, 15, 07800 Eivissa, Ibiza, Illes Balears.">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Casa de Rosa | Carrer de Font i Quer, 15, 07800 Eivissa | Ibiza, Illes Balears">
  <meta property="og:description" content="Casa de Rosa — Healthy Breakfast &amp; Lunch | Specialty Coffee | Vinyls — Carrer de Font i Quer, 15, 07800 Eivissa, Ibiza, Illes Balears.">
  <meta property="og:image" content="social/og-image.png">
  <meta property="og:image:alt" content="Casa de Rosa — Healthy Breakfast &amp; Lunch | Specialty Coffee | Vinyls — Carrer de Font i Quer, 15, 07800 Eivissa, Ibiza, Illes Balears.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Casa de Rosa | Carrer de Font i Quer, 15, 07800 Eivissa | Ibiza, Illes Balears">
  <meta name="twitter:description" content="Casa de Rosa — Healthy Breakfast &amp; Lunch | Specialty Coffee | Vinyls — Carrer de Font i Quer, 15, 07800 Eivissa, Ibiza, Illes Balears.">
  <meta name="twitter:image" content="social/og-image.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;500;600&display=swap" rel="stylesheet">
  <script src="vendor/pdfjs/pdf.min.js" defer></script>
  <style>
    :root {
      --canvas: #e2d9d5;
      --accent: #a0471a;
      --pad: 22px;
      --viewer-gap: 16px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; overflow: hidden; }
    body {
      margin: 0;
      height: 100dvh;
      background: var(--canvas);
      color: var(--accent);
      font-family: "Work Sans", "Helvetica Neue", Arial, sans-serif;
      overflow: hidden;
    }
    .frame {
      width: min(1200px, 100%);
      height: 100%;
      margin: 0 auto;
      background: var(--canvas);
      border-radius: 12px;
      overflow: hidden;
      display: grid;
      grid-template-rows: auto auto 1fr;
      min-height: 0;
    }
    header {
      display: grid;
      grid-template-columns: minmax(0, 1fr) auto;
      gap: 16px;
      align-items: center;
      padding: 22px var(--pad) 18px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 14px;
      min-width: 0;
    }
    .brand img {
      height: 96px;
      width: auto;
      max-width: 100%;
    }
    .title {
      margin: 0 0 8px;
      font-size: 20px;
      line-height: 1.4;
      color: var(--accent);
      font-weight: 500;
    }
    .tagline {
      margin: 4px 0;
      font-size: 17px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: var(--accent);
      font-weight: 600;
    }
    .title.address {
      margin-top: 10px;
    }
    .tagline.hours {
      margin-top: 34px;
      margin-bottom: 44px;
      font-size: 21px;
    }
    .tagline.updated {
      font-size: 20px;
      line-height: 1.6;
      letter-spacing: 0;
      text-transform: none;
      font-weight: 400;
      margin-top: 8px;
      display: block;
      opacity: 0.8;
    }
    .tagline.updated-mobile {
      display: none;
      margin-top: 0;
    }
    .inline-link {
      color: inherit;
      text-decoration: underline;
      text-decoration-thickness: 1px;
      text-underline-offset: 3px;
    }
    .controls {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: flex-end;
      flex-wrap: wrap;
      font-size: 20px;
      line-height: 1.6;
      letter-spacing: 0;
      text-transform: none;
      font-weight: 400;
    }
    .actions {
      display: inline-flex;
      gap: 12px;
      align-items: center;
    }
    .mobile-actions {
      display: none;
      padding: 0 var(--pad) 10px;
      justify-content: flex-end;
      gap: 12px;
      align-items: center;
      font-size: 20px;
      line-height: 1.6;
      font-weight: 400;
      opacity: 0.8;
      white-space: nowrap;
    }
    .lang {
      border: none;
      background: transparent;
      color: var(--accent);
      padding: 0;
      font: inherit;
      cursor: pointer;
      text-decoration: none;
      opacity: 0.8;
      line-height: 1.6;
    }
    .lang.active {
      text-decoration: underline;
      text-underline-offset: 4px;
      opacity: 1;
    }
    .sep {
      opacity: 0.8;
      user-select: none;
    }
    .action {
      border: none;
      background: transparent;
      color: var(--accent);
      padding: 0;
      font: inherit;
      cursor: pointer;
      text-decoration: underline;
      text-underline-offset: 4px;
      opacity: 0.8;
    }
    .action:hover { opacity: 1; }
    .summary {
      padding: 0 var(--pad) 10px;
      font-size: 14px;
      display: block;
      color: var(--accent);
    }
    .summary-top {
      display: grid;
      grid-template-columns: 1fr auto;
      column-gap: 18px;
      align-items: baseline;
    }
    .summary-top .title {
      margin: 0;
    }
    .summary-top .tagline.updated {
      margin: 0;
    }
    .viewer {
      padding: 0 0 var(--viewer-gap);
      min-height: 0;
      overflow: hidden;
      height: 100%;
    }
    .pdf-viewport {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: var(--canvas);
      touch-action: none;
    }
    .pdf-pages {
      position: absolute;
      left: 0;
      top: 0;
      transform-origin: 0 0;
      will-change: transform;
    }
    canvas.pdf-canvas {
      display: block;
      background: var(--canvas);
    }
    .pdf-gap {
      height: 14px;
    }
    .fallback {
      padding: 18px 14px;
      font-size: 14px;
      color: var(--accent);
    }
    @media (max-width: 720px) {
      :root { --pad: 18px; }
      header {
        grid-template-columns: minmax(0, 1fr) auto;
        justify-items: stretch;
      }
      .brand img {
        height: auto;
        max-height: 72px;
        max-width: 58vw;
      }
      .controls {
        width: auto;
        justify-content: flex-end;
        flex-wrap: nowrap;
        white-space: nowrap;
      }
      .lang { flex-shrink: 0; }
      .actions { display: none; }
      .mobile-actions { display: flex; }
      .summary-top { grid-template-columns: 1fr; row-gap: 6px; }
      .summary-top .tagline.updated { display: none; }
      .tagline.updated-mobile { display: block; margin-bottom: 24px; }
      :root { --viewer-gap: 0px; }
    }
    @media (max-height: 760px) {
      header { padding-bottom: 12px; }
      .tagline.hours { margin-top: 18px; margin-bottom: 28px; }
    }
  </style>
</head>
<body>
  <div class="frame">
    <header>
      <div class="brand">
        <img src="Logo-CdR-Red-Light.svg" alt="Casa de Rosa logotype">
      </div>
      <div class="controls">
        <button class="lang" aria-pressed="false" data-lang="es">ES</button>
        <span class="sep" aria-hidden="true">|</span>
        <button class="lang active" aria-pressed="true" data-lang="en">EN</button>
        <span class="sep actions" aria-hidden="true">|</span>
        <span class="actions">
          <button class="action" type="button" data-action="fullscreen">Fullscreen</button>
          <a class="action" data-action="download" href="CdR-Menu-2026-01-12-EN.pdf" download>Download</a>
          <button class="action" type="button" data-action="share" style="display:none">Share</button>
        </span>
      </div>
    </header>
    <div class="mobile-actions" role="toolbar" aria-label="Menu actions">
      <button class="action" type="button" data-action="fullscreen">Fullscreen</button>
      <span class="sep" aria-hidden="true">|</span>
      <a class="action" data-action="download" href="CdR-Menu-2026-01-12-EN.pdf" download>Download</a>
      <span class="sep" aria-hidden="true">|</span>
      <button class="action" type="button" data-action="share" style="display:none">Share</button>
    </div>

    <div class="summary" data-lang-copy="en">
      <div class="summary-top">
        <p class="title">Healthy Breakfast &amp; Lunch | Specialty Coffee | Vinyls</p>
        <div class="tagline updated">Updated 12 Jan 2026</div>
      </div>
      <p class="title address">
        <a class="inline-link" href="https://maps.app.goo.gl/YesgsyjPg6qBRamg9" target="_blank" rel="noreferrer">Carrer de Font i Quer, 15, 07800 Eivissa, Ibiza, Illes Balears</a>
      </p>
      <p class="tagline hours">Mon-Fri 9:00-18:00 | Sat-Sun Closed</p>
      <div class="tagline updated updated-mobile">Updated 12 Jan 2026</div>
    </div>
    <div class="summary" data-lang-copy="es" style="display:none">
      <div class="summary-top">
        <p class="title">Desayunos y comida saludable | Café de especialidad | Vinilos</p>
        <div class="tagline updated">Menú actualizado 12 Ene 2026</div>
      </div>
      <p class="title address">
        <a class="inline-link" href="https://maps.app.goo.gl/YesgsyjPg6qBRamg9" target="_blank" rel="noreferrer">Carrer de Font i Quer, 15, 07800 Eivissa, Ibiza, Illes Balears</a>
      </p>
      <p class="tagline hours">Lun-Vie 9:00-18:00 | Sáb-Dom Cerrado</p>
      <div class="tagline updated updated-mobile">Menú actualizado 12 Ene 2026</div>
    </div>

    <section class="viewer">
      <div class="pdf-viewport" id="pdfViewport" aria-label="Menu PDF viewer">
        <div class="pdf-pages" id="pdfPages"></div>
      </div>
      <div class="fallback" id="pdfFallback" style="display:none">
        PDF preview failed to load. <a id="pdfFallbackLink" href="CdR-Menu-2026-01-12-EN.pdf" target="_blank" rel="noreferrer">Open menu</a>.
      </div>
    </section>

  </div>

  <script>
    const PDF_FILES = {
      en: 'CdR-Menu-2026-01-12-EN.pdf',
      es: 'CdR-Menu-2026-01-12-ES.pdf',
    };

    const actionLabels = {
      en: {
        fullscreen: 'Fullscreen',
        download: 'Download',
        share: 'Share',
        shareTitle: 'Casa de Rosa | Healthy Breakfast & Lunch | Specialty Coffee | Vinyls',
      },
      es: {
        fullscreen: 'Pantalla completa',
        download: 'Descargar',
        share: 'Compartir',
        shareTitle: 'Casa de Rosa | Desayunos y comida saludable | Café de especialidad | Vinilos',
      },
    };

    const buttons = Array.from(document.querySelectorAll('.lang'));
    const summaries = Array.from(document.querySelectorAll('[data-lang-copy]'));
    const pdfViewport = document.getElementById('pdfViewport');
    const pdfPages = document.getElementById('pdfPages');
    const pdfFallback = document.getElementById('pdfFallback');
    const pdfFallbackLink = document.getElementById('pdfFallbackLink');

    function isSpanishLocale(locale) {
      const value = String(locale || '').toLowerCase();
      return value.startsWith('es') || value.startsWith('ca');
    }

    function getDefaultLanguage() {
      const locales = Array.isArray(navigator.languages) && navigator.languages.length
        ? navigator.languages
        : [navigator.language];
      return isSpanishLocale(locales[0]) ? 'es' : 'en';
    }

    function getPdfjs() {
      // `pdfjsLib` is provided by `vendor/pdfjs/pdf.min.js`.
      // eslint-disable-next-line no-undef
      return typeof pdfjsLib !== 'undefined' ? pdfjsLib : null;
    }

    const view = {
      scale: 1,
      tx: 0,
      ty: 0,
      fitScale: 1,
      contentWidth: 0,
      contentHeight: 0,
    };

    const gesture = {
      pointers: new Map(),
      start: null,
    };

    let loadToken = 0;

    function applyTransform() {
      pdfPages.style.transform = `translate(${view.tx}px, ${view.ty}px) scale(${view.scale})`;
    }

    function clamp(value, min, max) {
      return Math.min(max, Math.max(min, value));
    }

    function clampPan() {
      const vw = pdfViewport.clientWidth;
      const vh = pdfViewport.clientHeight;
      const scaledW = view.contentWidth * view.scale;
      const scaledH = view.contentHeight * view.scale;
      if (scaledW <= vw) {
        view.tx = Math.floor((vw - scaledW) / 2);
      } else {
        view.tx = clamp(view.tx, vw - scaledW, 0);
      }

      if (scaledH <= vh) {
        view.ty = 0;
      } else {
        view.ty = clamp(view.ty, vh - scaledH, 0);
      }
    }

    function fitToViewport(preserveZoom = false) {
      const vw = pdfViewport.clientWidth;
      if (!vw || !view.contentWidth) return;

      const zoomFactor = preserveZoom ? (view.scale / view.fitScale) : 1;
      view.fitScale = (vw / view.contentWidth);
      view.scale = clamp(view.fitScale * zoomFactor, view.fitScale * 0.5, view.fitScale * 4);

      view.tx = Math.max(0, Math.floor((vw - (view.contentWidth * view.scale)) / 2));
      clampPan();
      applyTransform();
    }

    async function renderPdf(url) {
      const token = ++loadToken;
      pdfFallback.style.display = 'none';
      pdfFallbackLink.href = url;

      const pdfjs = getPdfjs();
      if (!pdfjs) {
        pdfFallback.style.display = 'block';
        return;
      }

      pdfjs.GlobalWorkerOptions.workerSrc = 'vendor/pdfjs/pdf.worker.min.js';

      try {
        const doc = await pdfjs.getDocument({ url }).promise;
        if (token !== loadToken) return;

        pdfPages.innerHTML = '';
        view.contentWidth = 0;
        view.contentHeight = 0;

        const dpr = window.devicePixelRatio || 1;
        const gap = 14;

        for (let i = 1; i <= doc.numPages; i++) {
          const page = await doc.getPage(i);
          if (token !== loadToken) return;

          const viewport = page.getViewport({ scale: 1 });
          const renderViewport = page.getViewport({ scale: dpr });

          const canvas = document.createElement('canvas');
          canvas.className = 'pdf-canvas';
          canvas.width = Math.floor(renderViewport.width);
          canvas.height = Math.floor(renderViewport.height);
          canvas.style.width = `${Math.floor(viewport.width)}px`;
          canvas.style.height = `${Math.floor(viewport.height)}px`;

          const ctx = canvas.getContext('2d', { alpha: false });
          await page.render({ canvasContext: ctx, viewport: renderViewport }).promise;

          pdfPages.appendChild(canvas);
          view.contentWidth = Math.max(view.contentWidth, viewport.width);
          view.contentHeight += viewport.height;

          if (i !== doc.numPages) {
            const spacer = document.createElement('div');
            spacer.className = 'pdf-gap';
            spacer.style.height = `${gap}px`;
            pdfPages.appendChild(spacer);
            view.contentHeight += gap;
          }
        }

        view.scale = 1;
        view.tx = 0;
        view.ty = 0;
        applyTransform();
        fitToViewport(false);
      } catch {
        if (token !== loadToken) return;
        pdfFallback.style.display = 'block';
      }
    }

    function setLanguage(lang) {
      const normalized = lang === 'es' ? 'es' : 'en';
      const labels = actionLabels[normalized];
      const pdfSrc = PDF_FILES[normalized];

      buttons.forEach(b => {
        const isActive = b.getAttribute('data-lang') === normalized;
        b.setAttribute('aria-pressed', isActive ? 'true' : 'false');
        b.classList.toggle('active', isActive);
      });

      summaries.forEach(block => {
        const match = block.getAttribute('data-lang-copy') === normalized;
        block.style.display = match ? 'block' : 'none';
      });

      document.querySelectorAll('[data-action="download"]').forEach(link => {
        if (!(link instanceof HTMLAnchorElement)) return;
        link.href = pdfSrc;
        link.textContent = labels.download;
      });

      document.querySelectorAll('[data-action="fullscreen"]').forEach(btn => {
        btn.textContent = labels.fullscreen;
      });

      document.querySelectorAll('[data-action="share"]').forEach(btn => {
        btn.textContent = labels.share;
        btn.style.display = navigator.share ? '' : 'none';
      });

      document.documentElement.lang = normalized;
      document.documentElement.dataset.shareTitle = labels.shareTitle;

      renderPdf(pdfSrc);
    }

    buttons.forEach(btn => {
      btn.addEventListener('click', (event) => {
        event.preventDefault();
        setLanguage(btn.getAttribute('data-lang'));
      });
    });

    function updateOnResize() {
      fitToViewport(true);
    }

    window.addEventListener('resize', updateOnResize);

    function getCenterAndDistance() {
      const pts = Array.from(gesture.pointers.values());
      const a = pts[0];
      const b = pts[1];
      const cx = (a.x + b.x) / 2;
      const cy = (a.y + b.y) / 2;
      const dx = a.x - b.x;
      const dy = a.y - b.y;
      return { cx, cy, dist: Math.hypot(dx, dy) };
    }

    function screenToContent(x, y) {
      return {
        x: (x - view.tx) / view.scale,
        y: (y - view.ty) / view.scale,
      };
    }

    pdfViewport.addEventListener('pointerdown', (event) => {
      event.preventDefault();
      pdfViewport.setPointerCapture(event.pointerId);
      gesture.pointers.set(event.pointerId, { x: event.clientX, y: event.clientY });

      if (gesture.pointers.size === 1) {
        gesture.start = { type: 'pan', x: event.clientX, y: event.clientY, tx: view.tx, ty: view.ty };
      }

      if (gesture.pointers.size === 2) {
        const { cx, cy, dist } = getCenterAndDistance();
        gesture.start = {
          type: 'pinch',
          cx,
          cy,
          dist,
          scale: view.scale,
          tx: view.tx,
          ty: view.ty,
          anchor: {
            x: (cx - view.tx) / view.scale,
            y: (cy - view.ty) / view.scale,
          },
        };
      }
    }, { passive: false });

    pdfViewport.addEventListener('pointermove', (event) => {
      if (!gesture.pointers.has(event.pointerId)) return;
      event.preventDefault();
      gesture.pointers.set(event.pointerId, { x: event.clientX, y: event.clientY });

      if (!gesture.start) return;

      if (gesture.start.type === 'pan' && gesture.pointers.size === 1) {
        const dx = event.clientX - gesture.start.x;
        const dy = event.clientY - gesture.start.y;
        view.tx = gesture.start.tx + dx;
        view.ty = gesture.start.ty + dy;
        clampPan();
        applyTransform();
      }

      if (gesture.start.type === 'pinch' && gesture.pointers.size === 2) {
        const { cx, cy, dist } = getCenterAndDistance();
        const nextScale = clamp(gesture.start.scale * (dist / gesture.start.dist), view.fitScale * 0.5, view.fitScale * 4);
        const anchor = gesture.start.anchor;
        view.scale = nextScale;
        view.tx = cx - (anchor.x * view.scale);
        view.ty = cy - (anchor.y * view.scale);
        clampPan();
        applyTransform();
      }
    }, { passive: false });

    function endPointer(event) {
      if (gesture.pointers.has(event.pointerId)) {
        gesture.pointers.delete(event.pointerId);
      }
      if (gesture.pointers.size === 1) {
        const remaining = Array.from(gesture.pointers.values())[0];
        gesture.start = { type: 'pan', x: remaining.x, y: remaining.y, tx: view.tx, ty: view.ty };
      } else if (gesture.pointers.size === 0) {
        gesture.start = null;
      }
    }

    pdfViewport.addEventListener('pointerup', endPointer);
    pdfViewport.addEventListener('pointercancel', endPointer);

    pdfViewport.addEventListener('wheel', (event) => {
      // Keep scrolling inside the viewer even though the page itself doesn't scroll.
      event.preventDefault();
      view.ty -= event.deltaY;
      clampPan();
      applyTransform();
    }, { passive: false });

    document.addEventListener('click', async (event) => {
      const target = event.target;
      if (!(target instanceof HTMLElement)) return;
      const action = target.getAttribute('data-action');
      if (!action) return;

      if (action === 'fullscreen') {
        event.preventDefault();
        if (document.fullscreenElement) {
          await document.exitFullscreen();
          return;
        }
        if (pdfViewport.requestFullscreen) {
          await pdfViewport.requestFullscreen();
        }
      }

      if (action === 'share') {
        event.preventDefault();
        if (!navigator.share) return;
        try {
          const title = document.documentElement.dataset.shareTitle || 'Casa de Rosa Menu';
          await navigator.share({ title, url: 'https://casaderosaibiza.com' });
        } catch {
          // ignore cancel
        }
      }
    });

    setLanguage(getDefaultLanguage());
  </script>
</body>
</html>
